function OTT(e,t,n,i){function o(){Tt=S.offsetWidth,Mt=S.offsetHeight,j=yt/Tt,$&&(Et=$/Tt),vt>1?M(1,10):xt?F():E(1,10)}function a(e,t){return"https://dl.dropboxusercontent.com/u/28729972/360_demo/"+X+"/"+X+e+"/"+String("000"+t).slice(-3)+".jpg"}function r(){gt=36,nt.innerHTML="",et.style.opacity="";var e=ut[gt];yt=e.naturalWidth,wt=e.naturalHeight,j=yt/Tt,s(e),H(!1,12,66),setTimeout(function(){tt.addEventListener("mousedown",h),tt.addEventListener("touchstart",h),tt.addEventListener("dblclick",v),tt.addEventListener("mousewheel",b),tt.addEventListener("DOMMouseScroll",x),tt.addEventListener("contextmenu",T),it.style.opacity=.2,it.className="blink",ot.style.bottom="0"},600),setTimeout(function(){B=!0},2e3)}function s(e){e.naturalWidth&&(rt.width=e.naturalWidth,rt.height=e.naturalHeight,st.drawImage(e,0,0))}function c(){B&&(B=!1,setTimeout(function(){it.style.opacity=0,it.className=""},200))}function u(){_&&clearTimeout(_)}function d(e){K*K+Q*Q>e&&u()}function l(e,t){t&&(K=e.pageX-G,Q=e.pageY-J),G=e.pageX,J=e.pageY}function h(e){if(pt)if(K=0,Q=0,ft=!1,mt=gt+.5,null==e.touches)e.preventDefault(),l(e,!1),_=setTimeout(v,1400,e),document.addEventListener("mousemove",p),document.addEventListener("mouseup",f);else if(e.touches.length<=2){if(1==e.touches.length){var t=e.targetTouches[0];l(t,!1),Z=0,_=setTimeout(v,1400,t)}else{var t=e.targetTouches[0],n=e.targetTouches[1],i=n.pageX-t.pageX,o=n.pageY-t.pageY;G=.5*(t.pageX+n.pageX),J=.5*(t.pageY+n.pageY),Z=Math.sqrt(i*i+o*o),u()}document.addEventListener("touchmove",p),document.addEventListener("touchend",f)}else u()}function p(e){if(null==e.touches)l(e,!0),d(2),m();else if(1==e.touches.length){e.preventDefault();var t=e.targetTouches[0];l(t,!0),d(12),m()}else if(2==e.touches.length){e.preventDefault();var t=e.targetTouches[0],n=e.targetTouches[1],i=.5*(t.pageX+n.pageX),o=.5*(t.pageY+n.pageY),a=n.pageX-t.pageX,r=n.pageY-t.pageY;K=i-G,Q=o-J,G=i,J=o,V=Math.sqrt(a*a+r*r),4*(V-Z)*(V-Z)>K*K+Q*Q?(bt=vt*(V/Z),V>Z?bt>1.5*Et&&(bt=1.5*Et):.96>bt&&(bt=.96),M(bt,1)):m(),Z=V}}function f(e){u(),null==e.touches?(this.removeEventListener("mousemove",p),this.removeEventListener("mouseup",f)):(this.removeEventListener("touchmove",p),this.removeEventListener("touchend",f)),1==vt?xt?F():Math.abs(K)>9&&Math.abs(K)>Math.abs(Q)?H(0>K,1e3,Math.abs(1200/K)):Math.abs(Q)>9&&Math.abs(Q)>Math.abs(K)&&(pt=!1,H(0>Q,Math.floor(24),12)):w()}function m(){vt>1?L():xt?F():Q*Q>3*K*K?(window.scrollBy(0,-Q),J-=Q):C()}function g(e,t){var n=Math.floor(Math.floor(e/t)*t*(1+t)/t)*t;return n>Et?Et:n}function v(e){l(e,!1),Et>vt?M(g(vt,.5),400):M(1,800)}function b(e){e.preventDefault(),pt&&(l(e,!1),y(.002*e.wheelDelta))}function x(e){e.preventDefault(),pt&&(l(e,!1),y(.08*-e.detail))}function y(e){u(),O&&clearTimeout(O),V=e,Z=Math.abs(e),Z>1&&(Z=1),V>0?(bt=vt*(1+Z),bt>1.5*Et&&(bt=1.5*Et)):(bt=vt/(1+Z),.96>bt&&(bt=.96)),M(bt,400*Z),O=setTimeout(w,400)}function w(){1.12>vt?M(1,400):vt>Et&&M(Et,400)}function T(){u(),document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",f),document.removeEventListener("touchmove",p),document.removeEventListener("touchend",f)}function M(e,t,n){if(ft=!1,xt&&F(),vt!=e){if(pt=!1,c(),1==e)R=0,U=0;else{var i=e/vt,o=G-S.offsetLeft,r=J-S.offsetTop;R=(o-et.offsetLeft)*i-o,U=(r-et.offsetTop)*i-r}if(E(e,t),q=setTimeout(function(){et.style.transition=""},t),vt=e,1>=vt)nt.innerHTML="",rt.width!=yt&&s(ut[gt]);else if(rt.width==yt){if(vt>1.2){var u=dt[gt];u?u.complete&&s(u):(dt[gt]=new Image,u=dt[gt],u.src=a("-p1800",gt+1),u.setAttribute("n",gt),u.onload=function(){const e=parseInt(this.getAttribute("n"));e==gt&&vt>1.2&&(nt.innerHTML="",s(this)),void 0==$&&($=this.naturalWidth,Et=$/Tt)})}1.6>vt?""!=nt.innerHTML&&(nt.innerHTML=""):vt>1.9&&""==nt.innerHTML&&(nt.innerHTML=A)}n||setTimeout(function(){pt=!0},t)}}function L(){0>K?R+=64+4096/(K-64):R-=64-4096/(K+64),0>Q?U+=64+4096/(Q-64):U-=64-4096/(Q+64),E(vt)}function E(e,t){var n=(e-1)*Tt,i=(e-1)*Mt;e>=1?(0>R?R=0:R>n&&(R=n),0>U?U=0:U>i&&(U=i)):(R>0?R=0:n>R&&(R=n),U>0?U=0:i>U&&(U=i)),t&&(q&&clearTimeout(q),et.style.transition="all "+.001*t+"s",et.style.width=Math.round(Tt*e)+"px",et.style.height=Math.round(Mt*e)+"px"),et.style.left=Math.round(-R)+"px",et.style.top=Math.round(-U)+"px"}function C(){0>K?mt-=1+10/(K-10):mt+=1-10/(K+10),mt>=I?mt%=I:0>mt&&(mt=I+mt%I),k(Math.floor(mt))}function k(e){e!=gt&&(c(),ut[e].naturalWidth&&ut[e].complete&&st.drawImage(ut[e],0,0),gt=e)}function H(e,t,n,i){ft=!0,setTimeout(function(){e?(0==gt&&(gt=I),k(gt-1)):(47==gt&&(gt=-1),k(gt+1)),n=99>n?1.09*n:99,t>1?ft&&H(e,t-1,n,i):(ft=!1,i?z(i):pt=!0)},Math.round(n))}function z(e){var t=document.createElement("div"),n=lt[e],i=n.r,o=n.x,a=n.y,r=n.info,s=0;.05>i?i=.05:i>.2&&(i=.2);const c=Math.round(i*Lt),u=Math.round(o*Tt),d=Math.round(a*Mt),l=(20*(1-j)*i+4*j-1)/3,h=Tt*(l-1),p=Mt*(l-1);var f=et.firstChild,m=f.cloneNode();ctx=m.getContext("2d"),et.appendChild(m),ctx.save(),ctx.beginPath(),ctx.arc(u*j,d*j,c*j,0,2*Math.PI),ctx.clip(),ctx.drawImage(f,0,0),ctx.restore(),ctx.lineWidth=4*j/l,ctx.strokeStyle="rgba(255,255,255,.5)",ctx.stroke(),f.style.cssText+="-webkit-filter:blur(8px) invert(15%);filter:blur(8px) invert(15%)",R=h*o,U=p*a,o>.5?(s=l*(Tt-u-c),h-R>s&&(R=h)):(s=l*(u-c),R>s&&(R=s)),a>.5?(s=l*(Mt-d-c),p-U>s&&(U=p)):(s=l*(d-c),U>s&&(U=s)),E(l,1600),t.className="eigenPtInfo",S.appendChild(t),t.innerHTML=r,b_high=a>.5?l*(d-c)-U:Mt+U-l*(d+c),s=b_high-t.offsetHeight-18,12>s?(a>.5?t.style.top="0":t.style.bottom="0",t.style.height=b_high-18+"px",t.style.overflowY="scroll"):a>.5?t.style.top=s+"px":t.style.bottom=s+"px",t.style.left=o*(Tt-t.offsetWidth)+"px",setTimeout(function(){pt=!0},500)}function F(){E(1,600),et.childElementCount>1&&(et.lastChild.remove(),et.firstChild.style.cssText=D,xt=0),S.childElementCount>4&&S.lastChild.remove(),ot.style.bottom="0"}const P=!!("ontouchstart"in window),Y=navigator.language,I=48,X=t,W='<svg viewBox="0 0 128 128"><circle fill="#FFF" cx="64" cy="64" r="64"/><path fill="#AAA" d="M109.6,49c0-10.5-1.7-20.6-4.8-30c0,0.1,0,0.2,0,0.3c0,4.4-1.6,8.5-4.3,11.6c-1.6-1.3-3.3-2.3-5.2-3.1C87,20.4,76,16,64,16s-23,4.4-31.4,11.7c-1.9,0.8-3.6,1.9-5.2,3.1c-2.7-3.1-4.3-7.2-4.3-11.6c0-0.1,0-0.2,0-0.3c-3.1,9.5-4.8,19.5-4.8,30c-1.6,4.7-2.4,9.8-2.4,15c0,26.5,21.5,48,48,48s48-21.5,48-48C112,58.8,111.2,53.7,109.6,49z M42.4,67.6c-9.9,0-18-8.1-18-18s8.1-18,18-18s18,8.1,18,18S52.3,67.6,42.4,67.6z M64,76.4c-2.4-2.5-4.4-5.5-5.9-8.7c2.4-2.1,4.4-4.7,5.9-7.6c1.4,2.9,3.4,5.5,5.9,7.6C68.4,71,66.4,73.9,64,76.4z M85.6,67.6c-9.9,0-18-8.1-18-18s8.1-18,18-18s18,8.1,18,18S95.5,67.6,85.6,67.6z"/></svg>',A='<svg viewBox="0 0 96 96"><circle cx="48" cy="48" fill="#BBB"><animate attributeName="r" from="6" to="48" dur="1.5s" repeatCount="indefinite"/><animate attributeName="opacity" from=".8" to="0" dur="1.5s" repeatCount="indefinite"/></circle></svg>',D="position:absolute;width:100%;height:100%;",N=P?["滑動進行 360° 觀看<br>雙指外撥以放大檢視","Swipe for a 360° view<br>Pinch out to zoom in"]:["拖曳進行 360° 觀看<br>向上捲動以放大檢視","Drag for a 360° view<br>Scroll up to zoom in"];var S=document.getElementById(e);S.style.cssText="position:relative;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;max-width:"+50*S.firstElementChild.width+"px;text-align:center;font:18px Helvetica,STHeiti,sans-serif;";var B,_,O,q,j,G,J,K,Q,R,U,V,Z,$,et=document.createElement("div"),tt=document.createElement("div"),nt=document.createElement("div"),it=document.createElement("p"),ot=document.createElement("div"),at=document.createElement("a"),rt=document.createElement("canvas"),st=rt.getContext("2d"),ct=document.createElement("style"),ut=new Array(I),dt=new Array(I),lt=[0],ht=[],pt=!1,ft=!1,mt=0,gt=0,vt=1,bt=1,xt=0,yt=0,wt=0,Tt=S.offsetWidth,Mt=S.offsetHeight,Lt=Math.max(Tt,Mt),Et=3;S.appendChild(tt),tt.appendChild(nt),tt.appendChild(it),S.appendChild(ot),S.appendChild(et),et.appendChild(rt),nt.style.top=.5*Mt-48+"px",nt.innerHTML=A,it.innerHTML=0==Y.indexOf("zh")?N[0]:N[1],et.style.cssText=D+"left:0;top:0;text-align:left;opacity:.1;transition:opacity 1s",rt.style.cssText=D,ot.style.bottom="-44px",ot.className="dashPod",tt.className="ctrLayer",ct.innerHTML=".ctrLayer{position:absolute;top:0;width:100%;height:100%;z-index:2;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}.ctrLayer:active{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.ctrLayer>div{position:relative;width:96px;height:96px;margin:auto;pointer-events:none}.ctrLayer p{position:absolute;top:0;width:100%;margin:0;padding:8px 0;opacity:0;background:#FFF;font-size:16px;transition:opacity 1s}.blink{animation:blink 4s infinite ease-in 1s;-webkit-animation:blink 4s infinite ease-in 1s}@keyframes blink{0%{opacity:.2}50%{opacity:.6}100%{opacity:.2}}@-webkit-keyframes blink{0%{opacity:.2}50%{opacity:.6}100%{opacity:.2}}.dashPod{position:absolute;width:100%;height:40px;opacity:.4;z-index:3;pointer-events:none;transition:bottom .6s}.dashPod:hover{opacity:.7}.dashPod>div{pointer-events:auto;cursor:pointer;float:left}.dashPod>div:first-child{margin-left:8px}.dashPod>div>p{width:10px;height:10px;background:rgba(128,128,128,.2);border-radius:50%;border:2px solid #FFF;box-shadow:0 2px 5px #999;margin:13px}.dashPod>div:hover>p{background:#FFF}.dashPod>a{pointer-events:auto;position:absolute;right:6px;width:36px;height:36px}.eigenPtInfo{position:absolute;box-sizing:border-box;border-radius:12px;max-width:70%;z-index:5;padding:10px;color:#222;text-shadow:0 1px 7px #FFF;background:rgba(255,255,255,.5)}",document.head.appendChild(ct),n.length>5&&(n=n.slice(0,5)),lt=lt.concat(n);const Ct=lt.length-1;if(Ct>0)for(var kt=0;Ct>kt;kt++)ht[kt]=document.createElement("div"),ht[kt].id=kt+1,ht[kt].appendChild(document.createElement("p")),ot.appendChild(ht[kt]),ht[kt].onclick=function(){S.focusPoint(this.id)};return i&&(at.innerHTML=W,at.href=i,at.setAttribute("target","_blank"),ot.appendChild(at)),window.addEventListener("resize",o),S.run=function(){function e(e,i,o,r){for(;n[e]!=i;n[e]++)ut[n[e]]=new Image,ut[n[e]].src=a("-p900",n[e]+1),ut[n[e]].onload=function(){t[e]++,t[e]==o&&r()}}var t=[0,0,0,0],n=[36,0,10,24];e(0,48,10,function(){e(1,10,9,function(){r(),setTimeout(function(){e(2,24,12,function(){e(3,36,11,function(){yt||r()})})},800)})})},S.focusPoint=function(e){ft=!1,pt=!1,ot.style.bottom="-44px";const t=lt[e].n-1,n=vt-1;setTimeout(function(){if(M(1,400*n,!0),t==gt)setTimeout(function(){z(e)},408*n);else{var i=t-gt;2*Math.abs(i)>I&&(i=0>i?i+I:i-I);var o=Math.abs(i),a=400*n-72*o-72;0>a&&(a=0),setTimeout(function(){H(0>i,o,64-2*o,e)},a)}xt=e},104)},S}